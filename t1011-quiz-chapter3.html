<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Chapitre 2 - Unit√© Centrale | T1011</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #09090b; --bg-secondary: #18181b; --bg-tertiary: #27272a;
            --bg-card: linear-gradient(145deg, rgba(39, 39, 42, 0.5), rgba(24, 24, 27, 0.8));
            --border: rgba(63, 63, 70, 0.5); --border-hover: rgba(113, 113, 122, 0.5);
            --text-primary: #fafafa; --text-secondary: #a1a1aa; --text-muted: #71717a;
            --accent-1: #3b82f6; --accent-2: #8b5cf6; --success: #22c55e; --danger: #ef4444;
            --gradient-primary: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }
        body { font-family: 'Sora', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; -webkit-font-smoothing: antialiased; }
        .bg-gradient { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(59, 130, 246, 0.15), transparent), radial-gradient(ellipse 60% 50% at 100% 50%, rgba(139, 92, 246, 0.1), transparent); pointer-events: none; z-index: 0; }
        .noise { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); opacity: 0.03; pointer-events: none; z-index: 1; }
        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; position: relative; z-index: 2; }
        .header { background: var(--bg-card); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 20px; padding: 24px 32px; margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .back-btn { display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; color: var(--text-secondary); text-decoration: none; font-size: 1.3rem; transition: all 0.3s ease; }
        .back-btn:hover { background: var(--bg-tertiary); border-color: var(--border-hover); color: var(--text-primary); transform: translateX(-3px); }
        .header-title h1 { font-size: 1.5rem; font-weight: 700; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-title p { font-size: 0.85rem; color: var(--text-muted); margin-top: 4px; }
        .header-score { text-align: center; padding: 12px 24px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; }
        .score-value { font-size: 1.8rem; font-weight: 700; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .score-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .progress-container { background: var(--bg-card); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 16px; padding: 20px 24px; margin-bottom: 32px; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .progress-text { font-size: 0.85rem; color: var(--text-secondary); font-weight: 600; }
        .progress-bar-bg { height: 10px; background: var(--bg-tertiary); border-radius: 100px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--gradient-primary); border-radius: 100px; transition: width 0.5s ease; width: 0%; }
        .question-card { background: var(--bg-card); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 20px; padding: 32px; margin-bottom: 24px; }
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .question-number { font-size: 0.8rem; font-weight: 600; color: var(--accent-1); text-transform: uppercase; letter-spacing: 1px; }
        .question-type { padding: 6px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 100px; font-size: 0.75rem; font-weight: 500; color: var(--text-muted); }
        .question-text { font-size: 1.1rem; font-weight: 500; color: var(--text-primary); line-height: 1.6; margin-bottom: 24px; }
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option { padding: 16px 20px; background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; font-size: 0.95rem; color: var(--text-secondary); }
        .option:hover { border-color: var(--border-hover); background: var(--bg-tertiary); color: var(--text-primary); }
        .option.selected { border-color: var(--accent-1); background: rgba(59, 130, 246, 0.1); color: var(--text-primary); }
        .option.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.1); color: var(--success); }
        .option.incorrect { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .option.disabled { cursor: not-allowed; opacity: 0.6; }
        .fill-blank-input { padding: 12px 16px; background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Sora', sans-serif; font-size: 0.95rem; width: 100%; max-width: 400px; transition: all 0.3s ease; }
        .fill-blank-input:focus { outline: none; border-color: var(--accent-1); background: var(--bg-tertiary); }
        .fill-blank-input.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.1); }
        .fill-blank-input.incorrect { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        .explanation { margin-top: 20px; padding: 16px 20px; background: rgba(59, 130, 246, 0.05); border-left: 3px solid var(--accent-1); border-radius: 8px; display: none; }
        .explanation.show { display: block; }
        .explanation-title { font-size: 0.85rem; font-weight: 600; color: var(--accent-1); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .explanation-text { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; }
        .buttons-container { display: flex; gap: 12px; margin-top: 32px; }
        .btn { flex: 1; padding: 14px 24px; border: none; border-radius: 12px; font-family: 'Sora', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary { background: var(--gradient-primary); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px -8px rgba(59, 130, 246, 0.5); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-secondary); }
        .btn-secondary:hover { background: var(--bg-tertiary); border-color: var(--border-hover); color: var(--text-primary); }
        .results-container { background: var(--bg-card); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 20px; padding: 40px; text-align: center; display: none; }
        .results-container.show { display: block; }
        .results-icon { font-size: 4rem; margin-bottom: 20px; }
        .results-title { font-size: 2rem; font-weight: 700; margin-bottom: 12px; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .results-score { font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 32px; }
        .results-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-bottom: 32px; }
        .result-stat { padding: 16px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; }
        .result-stat-value { font-size: 1.8rem; font-weight: 700; margin-bottom: 4px; }
        .result-stat-value.success { color: var(--success); }
        .result-stat-value.danger { color: var(--danger); }
        .result-stat-value.primary { background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .result-stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .hidden { display: none !important; }
        @media (max-width: 768px) {
            .header { flex-direction: column; align-items: flex-start; }
            .header-score { width: 100%; }
            .buttons-container { flex-direction: column; }
            .results-stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="noise"></div>

    <div class="container">
        <div class="header">
            <div class="header-left">
                <a href="index.html" class="back-btn">‚Üê</a>
                <div class="header-title">
                    <h1>Chapitre 3 - Microprocesseur</h1>
                    <p>Intel, AMD, Socket, Horloge</p>
                </div>
            </div>
            <div class="header-score">
                <div class="score-value" id="current-score">0%</div>
                <div class="score-label">Score</div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-header">
                <span class="progress-text">Question <span id="current-question">1</span>/<span id="total-questions">30</span></span>
                <span class="progress-text" id="progress-percentage">0%</span>
            </div>
            <div class="progress-bar-bg">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>

        <div id="quiz-container"></div>

        <div class="results-container" id="results-container">
            <div class="results-icon" id="results-icon">üéâ</div>
            <h2 class="results-title" id="results-title">Quiz termin√© !</h2>
            <p class="results-score" id="results-message">Excellent travail !</p>
            
            <div class="results-stats">
                <div class="result-stat">
                    <div class="result-stat-value primary" id="final-score">0%</div>
                    <div class="result-stat-label">Score Final</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value success" id="correct-answers">0</div>
                    <div class="result-stat-label">Correctes</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value danger" id="incorrect-answers">0</div>
                    <div class="result-stat-label">Incorrectes</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value primary" id="xp-earned">0</div>
                    <div class="result-stat-label">XP Gagn√©</div>
                </div>
            </div>

            <div class="buttons-container">
                <button class="btn btn-secondary" onclick="window.location.href='t1011-quiz-index.html'">Retour</button>
                <button class="btn btn-primary" onclick="restartQuiz()">Recommencer</button>
            </div>
        </div>
    </div>

    <script>
        const questionsBank = [
            // QCM
            {
                type: 'qcm',
                question: "En quelle ann√©e Intel a-t-il cr√©√© le premier microprocesseur, le 4004 ?",
                options: ["1969", "1971", "1973", "1975"],
                correct: 1,
                explanation: "Le premier microprocesseur Intel 4004 a √©t√© cr√©√© en 1971. Il poss√©dait un bus de donn√©es de 4 bits et fonctionnait √† 108 kHz."
            },
            {
                type: 'qcm',
                question: "Combien de transistors contenait le premier microprocesseur Intel 4004 ?",
                options: ["300", "2300", "5000", "10000"],
                correct: 1,
                explanation: "Le Intel 4004 contenait 2300 transistors, ce qui √©tait r√©volutionnaire pour l'√©poque (1971)."
            },
            {
                type: 'qcm',
                question: "Quelle est la largeur du bus de donn√©es du Intel 8088 ?",
                options: ["4 bits", "8 bits", "16 bits", "32 bits"],
                correct: 1,
                explanation: "Le 8088 poss√®de un bus de donn√©es externe de 8 bits, tandis que le 8086 a un bus de 16 bits. Le bus interne √©tait identique (16 bits)."
            },
            {
                type: 'qcm',
                question: "Combien de transistors contenait le Intel 8086 ?",
                options: ["2300", "15000", "29000", "50000"],
                correct: 2,
                explanation: "Le Intel 8086 contenait environ 29000 transistors, grav√©s en technologie 3 ¬µm."
            },
            {
                type: 'qcm',
                question: "Avec un bus d'adresse de 20 bits (Intel 8086), quelle est la capacit√© d'adressage maximale ?",
                options: ["64 Ko", "256 Ko", "1 Mo", "4 Mo"],
                correct: 2,
                explanation: "Avec 20 bits d'adresse : 2^20 = 1 Mo de m√©moire adressable maximum."
            },
            {
                type: 'qcm',
                question: "Quel processeur Intel de 1982 fut le premier √† pouvoir g√©rer le multit√¢che ?",
                options: ["8086", "80186", "80286", "80386"],
                correct: 2,
                explanation: "Le 80286 (1982) est le premier microprocesseur Intel √† pouvoir g√©rer plusieurs programmes √† la fois (multit√¢che)."
            },
            {
                type: 'qcm',
                question: "Quel processeur Intel de 1985 fut le premier vrai 32 bits avec 4 Go d'adressage ?",
                options: ["80286", "80386", "80486", "Pentium"],
                correct: 1,
                explanation: "Le 80386 (1985) est le premier processeur 32 bits complet avec un bus d'adresse de 32 bits permettant d'adresser 4 Go."
            },
            {
                type: 'qcm',
                question: "Quelle innovation majeure le 80386 a-t-il introduit pour am√©liorer les performances ?",
                options: ["M√©moire cache", "Pipeline", "Multi-core", "Hyper-threading"],
                correct: 1,
                explanation: "Le 80386 int√®gre l'assemblage en pipeline qui permet d'ex√©cuter une instruction avant que l'instruction pr√©c√©dente ne soit termin√©e."
            },
            {
                type: 'qcm',
                question: "Quelle taille de m√©moire cache le 80486 int√®gre-t-il ?",
                options: ["4 Ko", "8 Ko", "16 Ko", "32 Ko"],
                correct: 1,
                explanation: "Le 80486 (1989) int√®gre une m√©moire cache de 8 Ko, permettant d'accro√Ætre la vitesse de traitement."
            },
            {
                type: 'qcm',
                question: "Quelle est la fr√©quence maximale du Pentium III ?",
                options: ["450 MHz", "600 MHz", "1 GHz", "2 GHz"],
                correct: 2,
                explanation: "Le Pentium III (1999) atteint une fr√©quence maximale de 1 GHz (1000 MHz)."
            },
            {
                type: 'qcm',
                question: "Quelle est la fr√©quence maximale du Pentium 4 ?",
                options: ["1 GHz", "2 GHz", "3,06 GHz", "4 GHz"],
                correct: 2,
                explanation: "Le Pentium 4 (2000) atteint une fr√©quence maximale de 3,06 GHz."
            },
            {
                type: 'qcm',
                question: "Que signifie FSB ?",
                options: ["Fast System Bus", "Front Side Bus", "Full Speed Bus", "First Serial Bus"],
                correct: 1,
                explanation: "FSB signifie Front Side Bus : c'est le bus qui permet au processeur de communiquer avec le contr√¥leur de la m√©moire centrale."
            },
            {
                type: 'qcm',
                question: "Qu'est-ce que le chipset ?",
                options: [
                    "Un processeur secondaire",
                    "Un ensemble de puces g√©rant les flux entre le ¬µP et les composants",
                    "Une m√©moire cache",
                    "Un type de socket"
                ],
                correct: 1,
                explanation: "Le chipset (ensemble de puces) g√®re les flux de donn√©es entre le ¬µP et les composants de la carte m√®re (bus, m√©moire, disque dur, etc.)."
            },
            {
                type: 'qcm',
                question: "Qu'est-ce qu'un socket ?",
                options: [
                    "Un type de m√©moire",
                    "Un connecteur pour interfacer le processeur avec la carte m√®re",
                    "Un bus de donn√©es",
                    "Une unit√© de calcul"
                ],
                correct: 1,
                explanation: "Le socket (socle) est un connecteur sp√©cifique utilis√© pour interfacer le processeur avec la carte m√®re."
            },
            {
                type: 'qcm',
                question: "Qu'a √©nonc√© Gordon Moore dans sa c√©l√®bre 'loi de Moore' ?",
                options: [
                    "La vitesse des processeurs double chaque an",
                    "Le nombre de transistors double tous les 18 mois",
                    "La m√©moire double chaque ann√©e",
                    "Le prix des processeurs diminue de moiti√© chaque an"
                ],
                correct: 1,
                explanation: "La loi de Moore (r√©vis√©e en 1975) postule le doublement du nombre de transistors dans les circuits int√©gr√©s tous les 18 mois."
            },

            // QRM
            {
                type: 'qrm',
                question: "Quelles sont les principales caract√©ristiques d'un microprocesseur ? (Plusieurs r√©ponses possibles)",
                options: [
                    "Le jeu d'instructions qu'il peut ex√©cuter",
                    "Le nombre de transistors (complexit√©)",
                    "Le nombre de bits trait√©s simultan√©ment",
                    "La vitesse de l'horloge",
                    "La couleur du bo√Ætier"
                ],
                correct: [0, 1, 2, 3],
                explanation: "Les caract√©ristiques principales d'un ¬µP sont : le jeu d'instructions, la complexit√© (nombre de transistors), le nombre de bits trait√©s, et la vitesse d'horloge."
            },
            {
                type: 'qrm',
                question: "Quels sont les avantages de la miniaturisation du microprocesseur ? (Plusieurs r√©ponses possibles)",
                options: [
                    "Augmentation de la vitesse",
                    "R√©duction des co√ªts",
                    "Am√©lioration de la fiabilit√©",
                    "Cr√©ation d'ordinateurs plus petits",
                    "R√©duction de la consommation √©nerg√©tique"
                ],
                correct: [0, 1, 2, 3, 4],
                explanation: "TOUS ces √©l√©ments sont des avantages de la miniaturisation : vitesse accrue (distances r√©duites), co√ªts r√©duits, meilleure fiabilit√©, ordinateurs plus petits et consommation r√©duite."
            },
            {
                type: 'qrm',
                question: "Quelles affirmations sont vraies concernant le Pentium (1993) ? (Plusieurs r√©ponses possibles)",
                options: [
                    "Il poss√®de 2 caches s√©par√©s de 8 Ko chacun",
                    "Il a 2 unit√©s d'ex√©cution 32 bits fonctionnant simultan√©ment",
                    "Il est cadenc√© de 60 √† 200 MHz",
                    "Il int√®gre un coprocesseur math√©matique",
                    "Il est 8 bits"
                ],
                correct: [0, 1, 2],
                explanation: "Le Pentium (1993) a 2 caches de 8 Ko (instructions et donn√©es), 2 unit√©s d'ex√©cution 32 bits simultan√©es (architecture superscalaire), et fonctionne de 60 √† 200 MHz."
            },
            {
                type: 'qrm',
                question: "Concernant le Pentium 4, quelles affirmations sont correctes ? (Plusieurs r√©ponses possibles)",
                options: [
                    "Fr√©quence max : 3,06 GHz",
                    "42 millions de transistors",
                    "Bus syst√®me √† 400 puis 800 MHz",
                    "Technologie 0,18 puis 0,13 ¬µm",
                    "4 c≈ìurs"
                ],
                correct: [0, 1, 2, 3],
                explanation: "Le Pentium 4 atteint 3,06 GHz, contient 42 millions de transistors, a un bus √† 400/800 MHz, et utilise une gravure de 0,18 puis 0,13 ¬µm. Il n'a qu'1 seul c≈ìur."
            },
            {
                type: 'qrm',
                question: "Quelles sont les caract√©ristiques du Intel 8086 ? (Plusieurs r√©ponses possibles)",
                options: [
                    "29000 transistors",
                    "Gravure 3 ¬µm",
                    "Bus d'adresse de 20 bits",
                    "Adressage max de 1 Mo",
                    "Bus de donn√©es externe de 8 bits"
                ],
                correct: [0, 1, 2, 3],
                explanation: "Le 8086 a 29000 transistors, gravure 3 ¬µm, bus d'adresse 20 bits et adressage max 1 Mo. Son bus de donn√©es externe est de 16 bits (pas 8)."
            },

            // Fill in the blank
            {
                type: 'fill',
                question: "Le premier microprocesseur cr√©√© par Intel en 1971 √©tait le _______.",
                answer: ["4004", "Intel 4004"],
                explanation: "Le Intel 4004 (1971) est le premier microprocesseur au monde, avec 2300 transistors et un bus de 4 bits."
            },
            {
                type: 'fill',
                question: "Le Intel 4004 poss√©dait un bus de donn√©es de _______ bits.",
                answer: ["4"],
                explanation: "Le 4004 avait un bus de donn√©es de 4 bits, d'o√π son nom."
            },
            {
                type: 'fill',
                question: "FSB signifie Front _______ Bus.",
                answer: ["Side", "side"],
                explanation: "FSB = Front Side Bus, le bus qui connecte le processeur au contr√¥leur m√©moire."
            },
            {
                type: 'fill',
                question: "Le _______ est un ensemble de puces qui g√®re les flux entre le ¬µP et les composants de la carte m√®re.",
                answer: ["chipset", "Chipset"],
                explanation: "Le chipset est sp√©cifiquement con√ßu pour un type de ¬µP et g√®re les communications via le FSB."
            },
            {
                type: 'fill',
                question: "Le _______ est le connecteur qui interface le processeur avec la carte m√®re.",
                answer: ["socket", "Socket", "socle"],
                explanation: "Le socket (ou socle) est le connecteur physique permettant d'installer le processeur sur la carte m√®re."
            },
            {
                type: 'fill',
                question: "La loi de _______ postule le doublement du nombre de transistors tous les 18 mois.",
                answer: ["Moore", "moore"],
                explanation: "La loi de Moore, formul√©e par Gordon E. Moore, pr√©dit le doublement des performances tous les 18 mois."
            },
            {
                type: 'fill',
                question: "Le processeur Intel _______ de 1982 fut le premier √† g√©rer le multit√¢che.",
                answer: ["80286", "286"],
                explanation: "Le 80286 (1982) est le premier processeur Intel capable de g√©rer plusieurs programmes simultan√©ment (multit√¢che)."
            },
            {
                type: 'fill',
                question: "Le processeur Intel _______ de 1985 fut le premier vrai 32 bits.",
                answer: ["80386", "386"],
                explanation: "Le 80386 (1985) est le premier processeur Intel enti√®rement 32 bits avec 4 Go d'adressage."
            },
            {
                type: 'fill',
                question: "Le 80486 int√®gre _______ Ko de m√©moire cache.",
                answer: ["8"],
                explanation: "Le 80486 (1989) int√®gre une m√©moire cache de 8 Ko pour am√©liorer les performances."
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let answeredQuestions = 0;
        let shuffledQuestions = [];
        let userAnswers = [];

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function initQuiz() {
            shuffledQuestions = shuffleArray(questionsBank);
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = 0;
            userAnswers = new Array(shuffledQuestions.length).fill(null);
            document.getElementById('total-questions').textContent = shuffledQuestions.length;
            updateProgress();
            displayQuestion();
        }

        function displayQuestion() {
            const question = shuffledQuestions[currentQuestionIndex];
            const container = document.getElementById('quiz-container');
            let optionsHTML = '';
            
            if (question.type === 'qcm' || question.type === 'qrm') {
                optionsHTML = '<div class="options">';
                question.options.forEach((option, index) => {
                    const isSelected = userAnswers[currentQuestionIndex]?.includes(index);
                    optionsHTML += `<div class="option ${isSelected ? 'selected' : ''}" onclick="selectOption(${index})">${option}</div>`;
                });
                optionsHTML += '</div>';
            } else if (question.type === 'fill') {
                const userAnswer = userAnswers[currentQuestionIndex] || '';
                optionsHTML = `<input type="text" class="fill-blank-input" id="fill-input" placeholder="Entrez votre r√©ponse..." value="${userAnswer}" onkeyup="handleFillInput(event)">`;
            }
            
            const typeLabel = question.type === 'qcm' ? 'QCM' : question.type === 'qrm' ? 'QRM' : 'Texte √† trou';
            
            container.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number">Question ${currentQuestionIndex + 1}</div>
                        <div class="question-type">${typeLabel}</div>
                    </div>
                    <div class="question-text">${question.question}</div>
                    ${optionsHTML}
                    <div class="explanation" id="explanation">
                        <div class="explanation-title">üí° Explication</div>
                        <div class="explanation-text">${question.explanation}</div>
                    </div>
                </div>
                <div class="buttons-container">
                    ${currentQuestionIndex > 0 ? '<button class="btn btn-secondary" onclick="previousQuestion()">Pr√©c√©dent</button>' : ''}
                    ${currentQuestionIndex < shuffledQuestions.length - 1 
                        ? '<button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" disabled>Valider & Suivant</button>'
                        : '<button class="btn btn-primary" id="next-btn" onclick="finishQuiz()" disabled>Valider & Terminer</button>'}
                </div>
            `;

            if (userAnswers[currentQuestionIndex] !== null) {
                document.getElementById('next-btn').disabled = false;
            }
        }

        function selectOption(index) {
            const question = shuffledQuestions[currentQuestionIndex];
            if (question.type === 'qcm') {
                userAnswers[currentQuestionIndex] = [index];
                document.querySelectorAll('.option').forEach((opt, i) => {
                    opt.classList.toggle('selected', i === index);
                });
            } else if (question.type === 'qrm') {
                if (!userAnswers[currentQuestionIndex]) {
                    userAnswers[currentQuestionIndex] = [];
                }
                const answers = userAnswers[currentQuestionIndex];
                const idx = answers.indexOf(index);
                if (idx > -1) {
                    answers.splice(idx, 1);
                } else {
                    answers.push(index);
                }
                document.querySelectorAll('.option').forEach((opt, i) => {
                    opt.classList.toggle('selected', answers.includes(i));
                });
            }
            document.getElementById('next-btn').disabled = false;
        }

        function handleFillInput(event) {
            const value = event.target.value.trim();
            userAnswers[currentQuestionIndex] = value;
            document.getElementById('next-btn').disabled = value === '';
        }

        function validateAnswer() {
            const question = shuffledQuestions[currentQuestionIndex];
            const userAnswer = userAnswers[currentQuestionIndex];
            let isCorrect = false;

            if (question.type === 'qcm') {
                isCorrect = userAnswer[0] === question.correct;
                document.querySelectorAll('.option').forEach((opt, i) => {
                    opt.classList.add('disabled');
                    if (i === question.correct) {
                        opt.classList.add('correct');
                    } else if (userAnswer.includes(i)) {
                        opt.classList.add('incorrect');
                    }
                });
            } else if (question.type === 'qrm') {
                const sortedUser = [...userAnswer].sort();
                const sortedCorrect = [...question.correct].sort();
                isCorrect = JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect);
                document.querySelectorAll('.option').forEach((opt, i) => {
                    opt.classList.add('disabled');
                    if (question.correct.includes(i)) {
                        opt.classList.add('correct');
                    } else if (userAnswer.includes(i)) {
                        opt.classList.add('incorrect');
                    }
                });
            } else if (question.type === 'fill') {
                const normalizedUser = userAnswer.toLowerCase().trim();
                isCorrect = question.answer.some(ans => ans.toLowerCase() === normalizedUser);
                const input = document.getElementById('fill-input');
                input.disabled = true;
                if (isCorrect) {
                    input.classList.add('correct');
                } else {
                    input.classList.add('incorrect');
                }
            }

            if (isCorrect) score++;
            answeredQuestions++;
            document.getElementById('explanation').classList.add('show');
            updateProgress();
        }

        function nextQuestion() {
            if (userAnswers[currentQuestionIndex] === null) return;
            validateAnswer();
            setTimeout(() => {
                currentQuestionIndex++;
                displayQuestion();
                updateProgress();
            }, 1500);
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
                updateProgress();
            }
        }

        function finishQuiz() {
            if (userAnswers[currentQuestionIndex] === null) return;
            validateAnswer();
            setTimeout(() => {
                showResults();
            }, 1500);
        }

        function showResults() {
            const percentage = Math.round((score / shuffledQuestions.length) * 100);
            const xpEarned = score * 10;
            
            const progress = JSON.parse(localStorage.getItem('t1011-quiz-progress') || '{}');
            if (!progress.chapter3 || percentage > (progress.chapter3.score || 0)) {
                progress.chapter3 = {
                    completed: percentage >= 60,
                    score: percentage,
                    xp: xpEarned,
                    date: new Date().toISOString()
                };
                localStorage.setItem('t1011-quiz-progress', JSON.stringify(progress));
            }

            document.getElementById('quiz-container').classList.add('hidden');
            document.querySelector('.progress-container').classList.add('hidden');
            
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.classList.add('show');
            
            let icon = 'üéâ';
            let title = 'Quiz termin√© !';
            let message = 'Excellent travail !';
            
            if (percentage >= 90) {
                icon = 'üèÜ';
                title = 'Parfait !';
                message = 'Score exceptionnel ! Tu ma√Ætrises parfaitement ce chapitre !';
            } else if (percentage >= 75) {
                icon = 'üéâ';
                title = 'Tr√®s bien !';
                message = 'Excellent score ! Continue comme √ßa !';
            } else if (percentage >= 60) {
                icon = '‚úÖ';
                title = 'Bien jou√© !';
                message = 'Bon score ! R√©vise encore un peu pour viser l\'excellence.';
            } else {
                icon = 'üìö';
                title = 'Chapitre non valid√©';
                message = 'Il faut 60% pour valider. R√©vise le cours et r√©essaye !';
            }
            
            document.getElementById('results-icon').textContent = icon;
            document.getElementById('results-title').textContent = title;
            document.getElementById('results-message').textContent = message;
            document.getElementById('final-score').textContent = percentage + '%';
            document.getElementById('correct-answers').textContent = score;
            document.getElementById('incorrect-answers').textContent = (shuffledQuestions.length - score);
            document.getElementById('xp-earned').textContent = xpEarned;
        }

        function updateProgress() {
            const percentage = Math.round((score / shuffledQuestions.length) * 100);
            const progressPercentage = Math.round(((currentQuestionIndex + 1) / shuffledQuestions.length) * 100);
            
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('current-score').textContent = percentage + '%';
            document.getElementById('progress-percentage').textContent = progressPercentage + '%';
            document.getElementById('progress-bar').style.width = progressPercentage + '%';
        }

        function restartQuiz() {
            document.getElementById('results-container').classList.remove('show');
            document.getElementById('quiz-container').classList.remove('hidden');
            document.querySelector('.progress-container').classList.remove('hidden');
            initQuiz();
        }

        document.addEventListener('DOMContentLoaded', initQuiz);
    </script>
</body>
</html>
