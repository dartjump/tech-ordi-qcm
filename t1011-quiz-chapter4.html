<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Chapitre 4 - M√©moire Introduction | T1011</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Styles identiques aux chapitres pr√©c√©dents */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg-primary: #09090b; --bg-secondary: #18181b; --bg-tertiary: #27272a; --bg-card: linear-gradient(145deg, rgba(39, 39, 42, 0.5), rgba(24, 24, 27, 0.8)); --border: rgba(63, 63, 70, 0.5); --border-hover: rgba(113, 113, 122, 0.5); --text-primary: #fafafa; --text-secondary: #a1a1aa; --text-muted: #71717a; --accent-1: #3b82f6; --accent-2: #8b5cf6; --success: #22c55e; --danger: #ef4444; --gradient-primary: linear-gradient(135deg, #3b82f6, #8b5cf6); }
        body { font-family: 'Sora', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; -webkit-font-smoothing: antialiased; }
        .bg-gradient { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(59, 130, 246, 0.15), transparent), radial-gradient(ellipse 60% 50% at 100% 50%, rgba(139, 92, 246, 0.1), transparent); pointer-events: none; z-index: 0; }
        .noise { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); opacity: 0.03; pointer-events: none; z-index: 1; }
        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; position: relative; z-index: 2; }
        .header { background: var(--bg-card); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 20px; padding: 24px 32px; margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .back-btn { display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; color: var(--text-secondary); text-decoration: none; font-size: 1.3rem; transition: all 0.3s ease; }
        .back-btn:hover { background: var(--bg-tertiary); border-color: var(--border-hover); color: var(--text-primary); transform: translateX(-3px); }
        .header-title h1 { font-size: 1.5rem; font-weight: 700; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-title p { font-size: 0.85rem; color: var(--text-muted); margin-top: 4px; }
        .header-score { text-align: center; padding: 12px 24px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; }
        .score-value { font-size: 1.8rem; font-weight: 700; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .score-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .progress-container { background: var(--bg-card); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 16px; padding: 20px 24px; margin-bottom: 32px; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .progress-text { font-size: 0.85rem; color: var(--text-secondary); font-weight: 600; }
        .progress-bar-bg { height: 10px; background: var(--bg-tertiary); border-radius: 100px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--gradient-primary); border-radius: 100px; transition: width 0.5s ease; width: 0%; }
        .question-card { background: var(--bg-card); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 20px; padding: 32px; margin-bottom: 24px; }
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .question-number { font-size: 0.8rem; font-weight: 600; color: var(--accent-1); text-transform: uppercase; letter-spacing: 1px; }
        .question-type { padding: 6px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 100px; font-size: 0.75rem; font-weight: 500; color: var(--text-muted); }
        .question-text { font-size: 1.1rem; font-weight: 500; color: var(--text-primary); line-height: 1.6; margin-bottom: 24px; }
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option { padding: 16px 20px; background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; font-size: 0.95rem; color: var(--text-secondary); }
        .option:hover { border-color: var(--border-hover); background: var(--bg-tertiary); color: var(--text-primary); }
        .option.selected { border-color: var(--accent-1); background: rgba(59, 130, 246, 0.1); color: var(--text-primary); }
        .option.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.1); color: var(--success); }
        .option.incorrect { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .option.disabled { cursor: not-allowed; opacity: 0.6; }
        .fill-blank-input { padding: 12px 16px; background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Sora', sans-serif; font-size: 0.95rem; width: 100%; max-width: 400px; transition: all 0.3s ease; }
        .fill-blank-input:focus { outline: none; border-color: var(--accent-1); background: var(--bg-tertiary); }
        .fill-blank-input.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.1); }
        .fill-blank-input.incorrect { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        .explanation { margin-top: 20px; padding: 16px 20px; background: rgba(59, 130, 246, 0.05); border-left: 3px solid var(--accent-1); border-radius: 8px; display: none; }
        .explanation.show { display: block; }
        .explanation-title { font-size: 0.85rem; font-weight: 600; color: var(--accent-1); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .explanation-text { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; }
        .buttons-container { display: flex; gap: 12px; margin-top: 32px; }
        .btn { flex: 1; padding: 14px 24px; border: none; border-radius: 12px; font-family: 'Sora', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary { background: var(--gradient-primary); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px -8px rgba(59, 130, 246, 0.5); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-secondary); }
        .btn-secondary:hover { background: var(--bg-tertiary); border-color: var(--border-hover); color: var(--text-primary); }
        .results-container { background: var(--bg-card); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 20px; padding: 40px; text-align: center; display: none; }
        .results-container.show { display: block; }
        .results-icon { font-size: 4rem; margin-bottom: 20px; }
        .results-title { font-size: 2rem; font-weight: 700; margin-bottom: 12px; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .results-score { font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 32px; }
        .results-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-bottom: 32px; }
        .result-stat { padding: 16px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; }
        .result-stat-value { font-size: 1.8rem; font-weight: 700; margin-bottom: 4px; }
        .result-stat-value.success { color: var(--success); }
        .result-stat-value.danger { color: var(--danger); }
        .result-stat-value.primary { background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .result-stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .hidden { display: none !important; }
        @media (max-width: 768px) { .header { flex-direction: column; align-items: flex-start; } .header-score { width: 100%; } .buttons-container { flex-direction: column; } .results-stats { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="noise"></div>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <a href="index.html" class="back-btn">‚Üê</a>
                <div class="header-title"><h1>Chapitre 4 - M√©moire Introduction</h1><p>RAM, ROM, SRAM, DRAM, Flash</p></div>
            </div>
            <div class="header-score"><div class="score-value" id="current-score">0%</div><div class="score-label">Score</div></div>
        </div>
        <div class="progress-container">
            <div class="progress-header"><span class="progress-text">Question <span id="current-question">1</span>/<span id="total-questions">30</span></span><span class="progress-text" id="progress-percentage">0%</span></div>
            <div class="progress-bar-bg"><div class="progress-bar" id="progress-bar"></div></div>
        </div>
        <div id="quiz-container"></div>
        <div class="results-container" id="results-container">
            <div class="results-icon" id="results-icon">üéâ</div>
            <h2 class="results-title" id="results-title">Quiz termin√© !</h2>
            <p class="results-score" id="results-message">Excellent travail !</p>
            <div class="results-stats">
                <div class="result-stat"><div class="result-stat-value primary" id="final-score">0%</div><div class="result-stat-label">Score Final</div></div>
                <div class="result-stat"><div class="result-stat-value success" id="correct-answers">0</div><div class="result-stat-label">Correctes</div></div>
                <div class="result-stat"><div class="result-stat-value danger" id="incorrect-answers">0</div><div class="result-stat-label">Incorrectes</div></div>
                <div class="result-stat"><div class="result-stat-value primary" id="xp-earned">0</div><div class="result-stat-label">XP Gagn√©</div></div>
            </div>
            <div class="buttons-container"><button class="btn btn-secondary" onclick="window.location.href='index.html'">Retour</button><button class="btn btn-primary" onclick="restartQuiz()">Recommencer</button></div>
        </div>
    </div>
    <script>
        const questionsBank = [
            { type: 'qcm', question: "Quelle est la caract√©ristique principale des m√©moires ROM ?", options: ["Volatiles et modifiables", "Non volatiles et en lecture seule", "Volatiles et rapides", "Non volatiles et modifiables"], correct: 1, explanation: "ROM (Read Only Memory) : m√©moire non volatile (garde les donn√©es sans alimentation) et en lecture seule (non modifiable)." },
            { type: 'qcm', question: "Que signifie RAM ?", options: ["Read Access Memory", "Random Access Memory", "Rapid Access Memory", "Read Alterable Memory"], correct: 1, explanation: "RAM signifie Random Access Memory (m√©moire √† acc√®s al√©atoire), permettant de lire et √©crire √† volont√©." },
            { type: 'qcm', question: "Quelle est la cellule de base d'une m√©moire DRAM ?", options: ["Transistor simple", "Condensateur", "Bascule √† 6 transistors", "Diode"], correct: 1, explanation: "La DRAM utilise l'effet capacitif du transistor (condensateur) qui se charge/d√©charge pour stocker l'information." },
            { type: 'qcm', question: "Combien de transistors composent une cellule de SRAM ?", options: ["1 transistor", "2 transistors", "6 transistors", "12 transistors"], correct: 2, explanation: "La SRAM utilise une bascule compos√©e de 6 transistors, cr√©ant deux √©tats stables sans besoin de rafra√Æchissement." },
            { type: 'qcm', question: "Pourquoi la DRAM n√©cessite-t-elle un rafra√Æchissement ?", options: ["Pour √©viter la surchauffe", "Car la charge du condensateur diminue avec le temps", "Pour synchroniser avec le CPU", "Pour √©conomiser l'√©nergie"], correct: 1, explanation: "Le condensateur de la DRAM perd sa charge avec le temps, il faut donc le recharger r√©guli√®rement (toutes les 15ns environ)." },
            { type: 'qcm', question: "Quelle est la tension de fonctionnement de la DDR3 ?", options: ["2,5V", "1,8V", "1,35V", "1,2V"], correct: 2, explanation: "La DDR3 fonctionne √† 1,35-1,5V, permettant une r√©duction de consommation de 40% par rapport √† la DDR2 (1,8V)." },
            { type: 'qcm', question: "Combien de mots par lecture la DDR2 peut-elle transf√©rer ?", options: ["2 mots", "4 mots", "8 mots", "16 mots"], correct: 1, explanation: "La DDR2 (2005) transf√®re 4 mots par lecture, contre 2 pour la DDR et 8 pour la DDR3." },
            { type: 'qcm', question: "Que signifie SDRAM ?", options: ["Super Dynamic RAM", "Synchronous Dynamic RAM", "Static Dynamic RAM", "Serial Dynamic RAM"], correct: 1, explanation: "SDRAM = Synchronous Dynamic RAM (1997), synchronis√©e avec la fr√©quence du processeur pour √©liminer les d√©lais d'attente." },
            { type: 'qcm', question: "Quelle est l'utilit√© de la CMOS RAM ?", options: ["Stocker le syst√®me d'exploitation", "Conserver la configuration du BIOS", "Acc√©l√©rer le processeur", "G√©rer la m√©moire cache"], correct: 1, explanation: "La CMOS RAM conserve la configuration du BIOS gr√¢ce √† une pile (dur√©e ~5 ans). Si d√©charg√©e, l'ordinateur demande date/heure." },
            { type: 'qcm', question: "Pourquoi la m√©moire graphique doit-elle permettre la lecture ET l'√©criture simultan√©es ?", options: ["Pour √©conomiser de l'√©nergie", "Le processeur graphique √©crit pendant que le RAMDAC lit pour l'affichage", "Pour augmenter la vitesse", "C'est une obligation technique"], correct: 1, explanation: "Le GPU √©crit les donn√©es pendant que le RAMDAC lit constamment pour afficher √† l'√©cran. La DRAM classique ne permet PAS cela." },
            { type: 'qrm', question: "Quelles sont les caract√©ristiques des m√©moires vives (RAM) ? (Plusieurs r√©ponses)", options: ["Peuvent √™tre lues ou √©crites √† volont√©", "Servent de m√©moire de travail", "S'effacent si non aliment√©es (volatiles)", "Temps d'acc√®s rapide", "Non volatiles"], correct: [0, 1, 2, 3], explanation: "Les RAM sont : lecture/√©criture, m√©moire de travail, volatiles (s'effacent sans alimentation), et rapides. Elles ne sont PAS non volatiles." },
            { type: 'qrm', question: "Quelles affirmations sont vraies concernant la SRAM ? (Plusieurs r√©ponses)", options: ["Compos√©e de 6 transistors (bascule)", "Pas besoin de rafra√Æchissement", "Plus ch√®re que la DRAM", "Prend 6x plus de place que la DRAM", "N√©cessite un rafra√Æchissement constant"], correct: [0, 1, 2, 3], explanation: "La SRAM utilise une bascule √† 6 transistors, ne n√©cessite pas de rafra√Æchissement, est plus ch√®re et occupe 6x plus d'espace que la DRAM." },
            { type: 'qrm', question: "Quels sont les inconv√©nients de la DRAM ? (Plusieurs r√©ponses)", options: ["N√©cessite un rafra√Æchissement r√©gulier", "Lecture destructive", "Pas de lecture et √©criture simultan√©es (sauf VRAM)", "Plus ch√®re que la SRAM", "Tr√®s lente"], correct: [0, 1, 2], explanation: "La DRAM n√©cessite un rafra√Æchissement, a une lecture destructive (doit recharger apr√®s lecture), et ne permet pas lecture/√©criture simultan√©es. Elle est moins ch√®re que la SRAM." },
            { type: 'qrm', question: "Quelle est l'√©volution chronologique des DDR ? (Ordre correct)", options: ["DDR (2003) - 2 mots/lecture - 2,5V", "DDR2 (2005) - 4 mots/lecture - 1,8V", "DDR3 (2007) - 8 mots/lecture - 1,35V", "DDR4 (2015) - 1,2V", "DDR5 (2021) - 1,1V"], correct: [0, 1, 2, 3, 4], explanation: "L'√©volution DDR : 2003 (2 mots, 2,5V) ‚Üí 2005 (4 mots, 1,8V) ‚Üí 2007 (8 mots, 1,35V) ‚Üí 2015 (1,2V) ‚Üí 2021 (1,1V), avec r√©duction progressive de consommation." },
            { type: 'qrm', question: "Que contient le BIOS ? (Plusieurs r√©ponses)", options: ["Programme du BIOS stock√© en EEPROM", "Configuration du BIOS stock√©e en CMOS RAM", "Le syst√®me d'exploitation", "Possibilit√© de 'flasher' le BIOS", "Donn√©es volatiles uniquement"], correct: [0, 1, 3], explanation: "Le BIOS comprend : le programme (EEPROM), la configuration (CMOS RAM avec pile), et peut √™tre flash√©. Il ne contient pas l'OS." },
            { type: 'fill', question: "RAM signifie Random _______ Memory.", answer: ["Access", "access"], explanation: "RAM = Random Access Memory (m√©moire √† acc√®s al√©atoire)." },
            { type: 'fill', question: "La DRAM utilise un _______ comme cellule de base pour stocker l'information.", answer: ["condensateur", "Condensateur"], explanation: "La DRAM utilise l'effet capacitif du transistor (condensateur) qui se charge/d√©charge." },
            { type: 'fill', question: "La SRAM est compos√©e d'une bascule √† _______ transistors.", answer: ["6", "six"], explanation: "Une cellule SRAM utilise une bascule √† 6 transistors cr√©ant deux √©tats stables." },
            { type: 'fill', question: "La DRAM n√©cessite un _______ r√©gulier car la charge diminue avec le temps.", answer: ["rafra√Æchissement", "rafraichissement", "refresh"], explanation: "Le rafra√Æchissement (refresh) recharge les condensateurs de la DRAM toutes les 15ns environ." },
            { type: 'fill', question: "SDRAM signifie _______ Dynamic RAM.", answer: ["Synchronous", "synchronous"], explanation: "SDRAM = Synchronous Dynamic RAM, synchronis√©e avec la fr√©quence du processeur." },
            { type: 'fill', question: "La DDR3 consomme environ _______V.", answer: ["1.35", "1,35", "1.5", "1,5"], explanation: "La DDR3 fonctionne √† 1,35-1,5V, soit une r√©duction de 40% par rapport √† la DDR2." },
            { type: 'fill', question: "La m√©moire _______ RAM conserve la configuration du BIOS gr√¢ce √† une pile.", answer: ["CMOS", "cmos"], explanation: "La CMOS RAM conserve les param√®tres du BIOS. Pile d√©charg√©e ‚Üí perte date/heure." }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let answeredQuestions = 0;
        let shuffledQuestions = [];
        let userAnswers = [];

        function shuffleArray(array) { const newArray = [...array]; for (let i = newArray.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; } return newArray; }
        
        function initQuiz() {
            shuffledQuestions = shuffleArray(questionsBank);
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = 0;
            userAnswers = new Array(shuffledQuestions.length).fill(null);
            document.getElementById('total-questions').textContent = shuffledQuestions.length;
            updateProgress();
            displayQuestion();
        }

        function displayQuestion() {
            const question = shuffledQuestions[currentQuestionIndex];
            const container = document.getElementById('quiz-container');
            let optionsHTML = '';
            
            if (question.type === 'qcm' || question.type === 'qrm') {
                optionsHTML = '<div class="options">';
                question.options.forEach((option, index) => {
                    const isSelected = userAnswers[currentQuestionIndex]?.includes(index);
                    optionsHTML += `<div class="option ${isSelected ? 'selected' : ''}" onclick="selectOption(${index})">${option}</div>`;
                });
                optionsHTML += '</div>';
            } else if (question.type === 'fill') {
                const userAnswer = userAnswers[currentQuestionIndex] || '';
                optionsHTML = `<input type="text" class="fill-blank-input" id="fill-input" placeholder="Entrez votre r√©ponse..." value="${userAnswer}" onkeyup="handleFillInput(event)">`;
            }
            
            const typeLabel = question.type === 'qcm' ? 'QCM' : question.type === 'qrm' ? 'QRM' : 'Texte √† trou';
            
            container.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number">Question ${currentQuestionIndex + 1}</div>
                        <div class="question-type">${typeLabel}</div>
                    </div>
                    <div class="question-text">${question.question}</div>
                    ${optionsHTML}
                    <div class="explanation" id="explanation"><div class="explanation-title">üí° Explication</div><div class="explanation-text">${question.explanation}</div></div>
                </div>
                <div class="buttons-container">
                    ${currentQuestionIndex > 0 ? '<button class="btn btn-secondary" onclick="previousQuestion()">Pr√©c√©dent</button>' : ''}
                    <button class="btn btn-primary" id="next-btn" onclick="${currentQuestionIndex < shuffledQuestions.length - 1 ? 'nextQuestion()' : 'finishQuiz()'}" disabled>Valider</button>
                </div>
            `;
            if (userAnswers[currentQuestionIndex] !== null) document.getElementById('next-btn').disabled = false;
        }

        function selectOption(index) {
            const question = shuffledQuestions[currentQuestionIndex];
            if (question.type === 'qcm') {
                userAnswers[currentQuestionIndex] = [index];
                document.querySelectorAll('.option').forEach((opt, i) => opt.classList.toggle('selected', i === index));
            } else if (question.type === 'qrm') {
                if (!userAnswers[currentQuestionIndex]) userAnswers[currentQuestionIndex] = [];
                const answers = userAnswers[currentQuestionIndex];
                const idx = answers.indexOf(index);
                if (idx > -1) answers.splice(idx, 1); else answers.push(index);
                document.querySelectorAll('.option').forEach((opt, i) => opt.classList.toggle('selected', answers.includes(i)));
            }
            document.getElementById('next-btn').disabled = false;
        }

        function handleFillInput(event) {
            const value = event.target.value.trim();
            userAnswers[currentQuestionIndex] = value;
            document.getElementById('next-btn').disabled = value === '';
        }

        function validateAnswer() {
            const question = shuffledQuestions[currentQuestionIndex];
            const userAnswer = userAnswers[currentQuestionIndex];
            let isCorrect = false;

            if (question.type === 'qcm') {
                isCorrect = userAnswer[0] === question.correct;
                document.querySelectorAll('.option').forEach((opt, i) => {
                    opt.classList.add('disabled');
                    if (i === question.correct) opt.classList.add('correct');
                    else if (userAnswer.includes(i)) opt.classList.add('incorrect');
                });
            } else if (question.type === 'qrm') {
                const sortedUser = [...userAnswer].sort();
                const sortedCorrect = [...question.correct].sort();
                isCorrect = JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect);
                document.querySelectorAll('.option').forEach((opt, i) => {
                    opt.classList.add('disabled');
                    if (question.correct.includes(i)) opt.classList.add('correct');
                    else if (userAnswer.includes(i)) opt.classList.add('incorrect');
                });
            } else if (question.type === 'fill') {
                const normalizedUser = userAnswer.toLowerCase().trim();
                isCorrect = question.answer.some(ans => ans.toLowerCase() === normalizedUser);
                const input = document.getElementById('fill-input');
                input.disabled = true;
                if (isCorrect) input.classList.add('correct'); else input.classList.add('incorrect');
            }

            if (isCorrect) score++;
            answeredQuestions++;
            document.getElementById('explanation').classList.add('show');
            updateProgress();
        }

        function nextQuestion() {
            if (userAnswers[currentQuestionIndex] === null) return;
            const isValidated = document.querySelector('.option.disabled') || document.getElementById('fill-input')?.disabled;
            const nextBtn = document.getElementById('next-btn');
            
            if (!isValidated) {
                validateAnswer();
                nextBtn.textContent = "Question Suivante ‚Üí";
            } else {
                currentQuestionIndex++;
                displayQuestion();
                updateProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) { currentQuestionIndex--; displayQuestion(); updateProgress(); }
        }

        function finishQuiz() {
            if (userAnswers[currentQuestionIndex] === null) return;
            const isValidated = document.querySelector('.option.disabled') || document.getElementById('fill-input')?.disabled;
            const nextBtn = document.getElementById('next-btn');

            if (!isValidated) {
                validateAnswer();
                nextBtn.textContent = "Voir les r√©sultats üèÜ";
            } else {
                showResults();
            }
        }

        function showResults() {
            const percentage = Math.round((score / shuffledQuestions.length) * 100);
            const xpEarned = score * 10;
            const progress = JSON.parse(localStorage.getItem('t1011-quiz-progress') || '{}');
            if (!progress.chapter4 || percentage > (progress.chapter4.score || 0)) {
                progress.chapter4 = { completed: percentage >= 60, score: percentage, xp: xpEarned, date: new Date().toISOString() };
                localStorage.setItem('t1011-quiz-progress', JSON.stringify(progress));
            }
            document.getElementById('quiz-container').classList.add('hidden');
            document.querySelector('.progress-container').classList.add('hidden');
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.classList.add('show');
            
            let icon = 'üéâ', title = 'Quiz termin√© !', message = 'Excellent travail !';
            if (percentage >= 90) { icon = 'üèÜ'; title = 'Parfait !'; message = 'Score exceptionnel !'; }
            else if (percentage >= 75) { icon = 'üéâ'; title = 'Tr√®s bien !'; message = 'Excellent score !'; }
            else if (percentage >= 60) { icon = '‚úÖ'; title = 'Bien jou√© !'; message = 'Bon score !'; }
            else { icon = 'üìö'; title = 'Chapitre non valid√©'; message = 'Il faut 60% pour valider.'; }
            
            document.getElementById('results-icon').textContent = icon;
            document.getElementById('results-title').textContent = title;
            document.getElementById('results-message').textContent = message;
            document.getElementById('final-score').textContent = percentage + '%';
            document.getElementById('correct-answers').textContent = score;
            document.getElementById('incorrect-answers').textContent = (shuffledQuestions.length - score);
            document.getElementById('xp-earned').textContent = xpEarned;
        }

        function updateProgress() {
            const percentage = Math.round((score / shuffledQuestions.length) * 100);
            const progressPercentage = Math.round(((currentQuestionIndex + 1) / shuffledQuestions.length) * 100);
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('current-score').textContent = percentage + '%';
            document.getElementById('progress-percentage').textContent = progressPercentage + '%';
            document.getElementById('progress-bar').style.width = progressPercentage + '%';
        }

        function restartQuiz() {
            document.getElementById('results-container').classList.remove('show');
            document.getElementById('quiz-container').classList.remove('hidden');
            document.querySelector('.progress-container').classList.remove('hidden');
            initQuiz();
        }

        document.addEventListener('DOMContentLoaded', initQuiz);
    </script>
</body>
</html>
